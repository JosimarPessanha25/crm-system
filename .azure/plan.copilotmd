# Azure Deployment Plan for CRM System

## **Goal**
Deploy the complete CRM System to Azure App Service with MySQL database for online testing and demonstration.

## **Project Information**
**AppName**: crm-system
- **Technology Stack**: PHP 8.2+ with Bootstrap 5 frontend
- **Application Type**: Complete CRM web application with REST API
- **Features**: Dashboard, Contacts, Opportunities, Activities, JWT Authentication
- **Database**: MySQL with 7 tables (users, companies, contacts, opportunities, activities, user_sessions, audit_logs)
- **Architecture**: SPA frontend + PHP REST API backend
- **Hosting Recommendation**: Azure App Service for PHP with MySQL flexible server

## **Azure Resources Architecture**
> **Install the mermaid extension in IDE to view the architecture.**

```mermaid
graph TB
    User[ğŸ‘¤ Users] --> AppService[ğŸŒ Azure App Service<br/>PHP 8.2]
    AppService --> MySQL[ğŸ—„ï¸ Azure Database<br/>for MySQL Flexible Server]
    AppService --> KeyVault[ğŸ” Azure Key Vault<br/>Connection Strings]
    AppService --> AppInsights[ğŸ“Š Application Insights<br/>Monitoring]
    AppInsights --> LogAnalytics[ğŸ“ˆ Log Analytics<br/>Workspace]
    
    style AppService fill:#0078d4,color:#fff
    style MySQL fill:#00758f,color:#fff
    style KeyVault fill:#ffb900,color:#000
    style AppInsights fill:#68217a,color:#fff
```

**Data Flow:**
- Users access the CRM through Azure App Service hosting the PHP application
- App Service connects to MySQL Flexible Server for all database operations
- Connection strings are securely stored in Azure Key Vault
- Application Insights collects telemetry and logs for monitoring

## **Recommended Azure Resources**

**Application Hosting**
- Application: crm-system
  - Hosting Service Type: Azure App Service (Linux)
  - SKU: B1 Basic (1 vCPU, 1.75GB RAM) - Perfect for testing
  - Configuration:
    - Runtime: PHP 8.2
    - OS: Linux
    - Environment Variables: 
      - `DB_HOST`: MySQL server endpoint
      - `DB_NAME`: crm_system
      - `DB_USER`: From Key Vault
      - `DB_PASSWORD`: From Key Vault
      - `JWT_SECRET`: Generated secure key

**Database Dependency**
- Azure Database for MySQL Flexible Server
  - SKU: B1ms (1 vCPU, 2GB RAM, Burstable)
  - Storage: 20GB with backup retention
  - Connection Type: Managed Identity + Key Vault
  - Environment Variables: 
    - `MYSQL_CONNECTION_STRING`: Stored in Key Vault

**Supporting Services**
- Application Insights: Performance and error monitoring
- Log Analytics Workspace: Centralized logging
- Key Vault: Secure storage for connection strings and secrets

**Security Configurations**
- Managed Identity: System-assigned identity for App Service
- Key Vault Access Policy: App Service managed identity with Get/List permissions
- MySQL Firewall: Allow Azure services access
- HTTPS Only: Enforce secure connections

## **Execution Steps**
> **Below are the steps for deployment**

1. **Provision Azure Infrastructure And Deploy Application:**
   1. Generate Bicep IaC files for all required Azure resources
   2. Pre-check Bicep files for syntax errors
   3. Run `azd up` to provision resources and deploy application
   4. Configure database connection and run migrations
   5. Verify deployment and application functionality

2. **Summary:**
   1. Document all provisioned resources and endpoints
   2. Create deployment summary with architecture diagram
   3. Provide access URLs and monitoring dashboards